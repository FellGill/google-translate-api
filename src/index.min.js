const languages=require('./languages.min');const tokenGenerator=require('./tokenGenerator.min');const querystring=require('querystring');const got=require('got');async function translate(text,options){try{if(typeof options!=='object')options={};text=String(text);let error;[options.from,options.to].forEach((lang)=>{if(lang&&!languages.isSupported(lang)){error=new Error();error.code=400;error.message=`Die Sprache '${lang}' wird nicht unterstÃ¼tzt.`}});if(error)throw error;if(!options.hasOwnProperty('from'))options.from='auto';if(!options.hasOwnProperty('to'))options.to='en';options.raw=Boolean(options.raw);options.from=languages.getISOCode(options.from);options.to=languages.getISOCode(options.to);let token=await tokenGenerator.generate(text);let url='https://translate.google.com/translate_a/single';let data={client:'gtx',sl:options.from,tl:options.to,hl:options.to,dt:['at','bd','ex','ld','md','qca','rw','rm','ss','t'],ie:'UTF-8',oe:'UTF-8',otf:1,ssel:0,tsel:0,kc:7,q:text,[token.name]:token.value};url=`${url}?${querystring.stringify(data)}`;let requestOptions;if(url.length>2048){delete data.q;requestOptions=[`${url}?${querystring.stringify(data)}`,{method:'POST',body:{q:text}}];requestOptions[1]=JSON.stringify(requestOptions[1])}
else{requestOptions=[url]}
let response=await got(...requestOptions);let result={text:'',from:{language:{didYouMean:!1,iso:''},text:{autoCorrected:!1,value:'',didYouMean:!1}},raw:''};if(options.raw){result.raw=response.body}
let body=JSON.parse(response.body);body[0].forEach((obj)=>{if(obj[0]){result.text+=obj[0]}});if(body[2]===body[8][0][0]){result.from.language.iso=body[2]}
else{result.from.language.didYouMean=!0;result.from.language.iso=body[8][0][0]}
if(body[7]&&body[7][0]){let str=body[7][0];str=str.replace(/<b><i>/g,'[');str=str.replace(/<\/i><\/b>/g,']');result.from.text.value=str;if(body[7][5]===!0){result.from.text.autoCorrected=!0}
else{result.from.text.didYouMean=!0}}
return result}
catch(e){if(e.name==='HTTPError'){let error=new Error();error.name=e.name;error.statusCode=e.statusCode;error.statusMessage=e.statusMessage;throw error}
throw e}}
module.exports=translate;module.exports.languages=languages
